!function e(t,r,o){function s(i,a){if(!r[i]){if(!t[i]){var n="function"==typeof require&&require;if(!a&&n)return n(i,!0);if(l)return l(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[i]={exports:{}};t[i][0].call(u.exports,function(e){var r=t[i][1][e];return s(r?r:e)},u,u.exports,e,t,r,o)}return r[i].exports}for(var l="function"==typeof require&&require,i=0;i<o.length;i++)s(o[i]);return s}({1:[function(e,t,r){!function(e){var t,r,o,s={init:function(l){e.ajax({url:l.url,type:"post",data:l.data,dataType:"json",success:function(i){i.success?(t=i.defaultConfig,i.userConfig&&0!=i.userConfig.length?(r=i.userConfig,s.format()):o=e.extend(!0,[],t),l.callback.success&&l.callback.success(i)):l.callback.systemError&&l.callback.systemError(i)},error:function(){l.callback.networkError&&l.callback.networkError()}})},getStyle:function(e){for(var t in o){var r=o[t];for(var s in r.childrens){var l=r.childrens[s];if(l.name==e)return l.value}}},setStyle:{css:function(t,r,o){var l;switch(r){case"backgroundImage":l="<style>"+t+"{background-image:url("+s.getStyle(o)+");}</style>)";break;case"backgroundColor":l="<style>"+t+"{background-color:"+s.getStyle(o)+";}</style>)";break;case"color":l="<style>"+t+"{color:"+s.getStyle(o)+";}</style>)";break;case"borderColor":l="<style>"+t+"{border-color:"+s.getStyle(o)+";}</style>)"}e("head").append(l)},html:function(t,r){e(t).html(s.getStyle(r))},image:function(t,r){e(t).attr("src",s.getStyle(r))}},format:function(){for(var s in t){var l,i=!1,a=t[s];for(var n in r){var c=r[n];a.name==c.name&&(i=!0,l=c)}if(i)for(var u in a.childrens){var i=!1;for(var d in l.childrens){var y=a.childrens[u],p=l.childrens[d];y.name==p.name&&(i=!0,void 0===y.system||0==y.system.length?void 0!==p.system&&delete p.system:p.system=y.system,p.title=y.title,"image"==y.type&&(p.size=y.size))}i||l.childrens.push(y)}else r.push(a)}for(var s in r){var l,i=!1,a=r[s];for(var n in t){var c=t[n];c.name==a.name&&(i=!0,l=c)}if(i)for(var u in a.childrens){var i=!1;for(var d in l.childrens)a.childrens[u].name==l.childrens[d].name&&(i=!0);i||a.childrens.splice(u,1)}else r.remove(a)}o=e.extend(!0,[],r)}};window.requireStyle=s}(Zepto)},{}],2:[function(e,t,r){!function(t){e("../../../../unit/common/js/scrollTip"),e("../requireStyle"),FastClick(document.body),t(function(){function e(e){t(".status-tip").html(e.needCreditsText)}function r(e){e.preventDefault(),window.navigator&&window.navigator.userAgent.indexOf("534.30")>0&&(p.style.opacity="0.99",setTimeout(function(){p.style.opacity=1},5)),m.beginPath(),m.fillStyle="#f00";var t=e.targetTouches[0].clientX-document.getElementById("scratch").getBoundingClientRect().left,r=e.targetTouches[0].clientY-document.getElementById("scratch").getBoundingClientRect().top;m.arc(t,r,40*window.remScale,0,2*Math.PI),m.fill(),m.closePath()}function o(e){f=!1,e.preventDefault();for(var r=0,o=m.getImageData((d-250*window.remScale)/2,(y-250*window.remScale)/2,250*window.remScale,250*window.remScale),s=0;s<o.data.length;s++)0==o.data[s]&&r++;if(r>=.4*o.data.length)switch(m.fillRect(0,0,d,y),lastResult.result){case 0:setTimeout(function(){t(".start").children("span").html("再来一张"),0===t(".start-dialog .sorry").length&&t(".start").before('<div class="sorry">很遗憾，您没有中奖!</div>'),i()},1e3);break;case 1:n();break;case 2:var l=lastResult.lottery;"coupon"==lastResult.lottery.type||"lucky"==lastResult.lottery.type?window.showCouponPrize({prize:{st_info_close:l.st_info_close,st_info:l.st_info,st_info_use:l.st_info_use,st_info_pic:l.st_info_pic,st_info_detail:l.st_info_detail,st_info_expouse:l.st_info_expouse,type:lastResult.lottery.type,img:lastResult.lottery.imgurl,title:lastResult.lottery.title,tip:lastResult.lottery.tip,validate:lastResult.lottery.validate,useBtnText:lastResult.lottery.useBtnText,showUse:lastResult.lottery.showUse,couponCode:lastResult.lottery.coupon_code,couponKey:lastResult.lottery.coupon_key,link:lastResult.lottery.link,logprarm:lastResult.exposure,downloadAppConfig:{openUrl:lastResult.lottery.openUrl,iosDownloadUrl:lastResult.lottery.iosDownloadUrl,androidDownloadUrl:lastResult.lottery.androidDownloadUrl}},callback:{close:function(){i()}}}):(t(".win-modal").show(),document.ontouchmove=function(e){e.preventDefault()},t(".start").children("span").html("开始刮奖"),t(".sorry").remove())}}function s(e){f=!0}function l(e){f&&(e.preventDefault(),m.beginPath(),m.fillStyle="#f00",m.arc(e.offsetX,e.offsetY,40,0,2*Math.PI),m.fill(),m.closePath())}function i(){t(".start").prop("disabled",!1),t(".scratch-cover-yellow").show(),t(".result-show").hide().find(".content").html(""),t(".error-show").hide(),t("#scratch").hide(),t(".start-dialog").show()}function a(e){t(".scratch-cover-yellow,.start-dialog,.result-show,#scratch").hide(),t(".error-show p").html(e.message),t(".error-show").show(),1==e.status?t(".getCreditsLink").attr("href","javascript:window.requirelogin();").html("请先登录").show():2==e.status?t(".getCreditsLink").attr("href",e.url).html("赚取"+CFG.unitName).show():(t(".getCreditsLink").hide(),setTimeout(function(){i()},1e3))}function n(){getToken(function(e){t.ajax({url:CFG.doJoin,type:"post",dataType:"json",data:e,success:function(e){if(e.success)setTimeout(function(){againOrderId=null,c(e.orderId)},1e3);else{var t="";

switch(e.status){
case 1:t="您还未登录";
case 2:t=CFG.unitName+"不足aaaa";
case 3:t="今日已抽完";
case 4:t="没有抽奖机会了";
case 5:t="活动已关闭";
default:t="系统错误"}if(2==e.status){var r={};if(e.getCreditsLink){var o=e.getCreditsLink;o.indexOf("?")==-1?o+="?dbnewopen":o.indexOf("dbnewopen")==-1&&(o+="&dbnewopen"),r={message:e.message||t,status:2,url:o}}else r={message:e.message||t};a(r)}else a(1==e.status?{message:e.message||t,status:1}:{message:e.message||t})}},error:function(){a({message:"网络异常，购买失败"})}})},a)}function c(e){t.ajax({url:CFG.quireOrder,type:"post",dataType:"json",data:{orderid:e,slotId:CFG.slotId},success:function(r){if(r.success){switch(window.lastResult=r,1!==r.result&&r.result!==-1&&t(".status-tip").html(r.element.needCreditsText),r.result){case-1:setTimeout(function(){c(e)},1e3);break;case 0:t(".result-show").css("background-color","#fff8da").find(".content").html('<img src="http://yun.duiba.com.cn/h5/activity/images/cry.png" />');break;case 1:t(".result-show").css("background-color","#fff8da").find(".content").html('<img src="http://yun.duiba.com.cn/h5/activity/images/again.png" /><p>免费再来一次</p>');break;case 2:t(".result-show").css("background-color","#fff").find(".content").html("<img src="+r.lottery.imgurl+" /><p>"+r.lottery.title+"</p>"),t(".lottery-info .title").html(r.lottery.title),t(".lottery-info img").attr("src",r.lottery.imgurl),"virtual"==r.lottery.type?(t(".lottery-info .help").hide(),t(".primary").html("马上查看")):(t(".lottery-info .help").show(),t(".primary").html("马上领取")),t(".primary").attr("href",r.lottery.link)}r.result!=-1&&(r.againTag&&(againOrderId=r.againTag),t(".start-dialog").hide(),m.globalCompositeOperation="destination-over",m.beginPath(),m.fillStyle="#979797",m.fillRect(0,0,552*window.remScale,302*window.remScale),m.closePath(),m.globalCompositeOperation="source-over",m.font=36*window.remScale+"px Hiragino Sans GB,STHeiTi",m.fillStyle="#e5e5e5",m.fillText("使劲刮我(｡ì _ í｡)",156*window.remScale,156*window.remScale),m.globalCompositeOperation="destination-out",m.closePath(),t("#scratch,.result-show").show(),t(".scratch-cover-yellow").hide())}else a({message:r.message})},error:function(){a({message:"网络异常，购买失败"})}})}var u;u=CFG.preview?{hdType:CFG.hdType,hdToolId:CFG.hdToolId,preview:CFG.preview}:{actId:CFG.actId},t.ajax({url:CFG.getElement,type:"post",data:u,dataType:"json",success:function(t){t.success&&e(t.element)}}),requireStyle.init({url:CFG.styleConfig,data:{actId:CFG.actId,hdType:CFG.hdType,hdToolId:CFG.hdToolId},callback:{success:function(){requireStyle.setStyle.css("body","backgroundColor","bgColor"),requireStyle.setStyle.image(".banner","theme"),requireStyle.setStyle.css(".record","backgroundImage","record"),requireStyle.setStyle.css(".apple","color","apple"),requireStyle.setStyle.css(".lottery-area .title span","color","prizesTitle"),requireStyle.setStyle.css(".lottery-area .title i","backgroundColor","prizesTitle"),requireStyle.setStyle.css(".description .title span","color","ruleTitle"),requireStyle.setStyle.css(".description .title i","backgroundColor","ruleTitle"),requireStyle.setStyle.css(".description .title","backgroundColor","ruleBg"),requireStyle.setStyle.css(".description .text","backgroundColor","ruleBg"),requireStyle.setStyle.css(".description .text","color","ruleTextColor"),requireStyle.setStyle.css(".probability-rules","backgroundColor","ruleBg"),requireStyle.setStyle.css(".scratch-main","backgroundImage","border"),requireStyle.setStyle.css(".start,.getCreditsLink","backgroundImage","start"),t("head").append("<style>.start:active,.start[disabled]{background-image:url("+requireStyle.getStyle("startActive")+");}</style>"),requireStyle.setStyle.css(".scratch-cover-yellow","backgroundColor","cardBg"),requireStyle.setStyle.css(".status-tip","color","statusColor"),requireStyle.setStyle.css(".status-tip span","color","statusNumColor"),"credits"==CFG.appType?t(".description .text").html(requireStyle.getStyle("ruleText")):t(".description .text").html(requireStyle.getStyle("freeRule")?requireStyle.getStyle("freeRule"):requireStyle.getStyle("ruleText")),requireStyle.getStyle("probabilityText")&&(requireStyle.setStyle.html(".probability-rules section","probabilityText"),t(".probability-rules").show()),t("head").append("<style>.description::before{background-image:url("+requireStyle.getStyle("ruleHeaderBg")+");}.description::after{background-image:url("+requireStyle.getStyle("ruleFooterBg")+");background-color:"+requireStyle.getStyle("ruleBg")+";}</style>"),t("#db-content").show()},systemError:function(e){t.modal("systemError",{title:"出错了",message:e.message})},networkError:function(){t.modal("networkError")}}});var d=552*window.remScale,y=302*window.remScale,p=document.getElementById("scratch");p.width=d,p.height=y;var m=p.getContext("2d");p.addEventListener("touchmove",r,!1),p.addEventListener("touchend",o,!1),p.addEventListener("mousedown",s),p.addEventListener("mouseup",o),p.addEventListener("mousemove",l);var f=!1;t(".start").on("click",function(){t(this).prop("disabled",!0),n()}),t(".cancel").on("click",function(){t(".win-modal").hide(),document.ontouchmove=null,i()}),t(".primary").on("click",function(){t(".win-modal").hide(),i()}),t(".probability-rules header").on("click",function(){t(this).toggleClass("show"),t(".probability-rules section").toggleClass("show"),t(window).scrollTop(t(document).height()-t(window).height())}),t(".prize").on("click",function(){if(!isShouGongKe){new GetPrizeDetail({url:"/hdtool/prizeDetail",prizeType:t(this).data("type"),data:{appItemId:t(this).data("appitemid"),itemId:t(this).data("itemid")}})}})})}(Zepto)},{"../../../../unit/common/js/scrollTip":3,"../requireStyle":1}],3:[function(e,t,r){!function(e){function t(t){e.ajax({url:t.url,timeout:6e4,data:t.data,dataType:"json",type:"post",success:function(e){e.success&&""!=e.lotteryRecord&&0!=e.lotteryRecord.length&&r(e.lotteryRecord)},error:function(){}})}function r(t){e("head").append('<style>.scroll-tip{height:.32rem;font-size:.1rem;line-height:.32rem;color:#666;width:100%;overflow:hidden;background-color:#fff}.scroll-tip i{width:.32rem;height:.32rem;float:left;background-image:url(http://yun.duiba.com.cn/webapp/img/bd.png);background-size:.16rem .15rem;background-position:center;background-repeat:no-repeat}.marquee{white-space:nowrap}.marquee p{display:inline-block;padding-right:.05rem}.marquee p span{color:#3070bf}.marquee-dialog{float:left;width:2.83rem;overflow:hidden}.scroll-tip::after{content:"";clear:both;display:table}</style>'),e("body").prepend('<div class="scroll-tip"><i></i><div class="marquee-dialog"><div class="marquee"><p></p></div></div></div>');var r="";e.each(t,function(e,t){r+="<span>"+t.namePrefix+"</span>"+t.name+";"}),e(".marquee p").html(r),e(".scroll-tip").show();for(var s=parseInt(e(".marquee-dialog").width()/e(".marquee p").eq(0).width())+1,l=0;l<s;l++)e(".marquee p").eq(0).clone(!0).appendTo(".marquee");e(".marquee").css("width",2*e(".marquee p").eq(0).width()),window.marqueInteval=setInterval(o,20)}function o(){var t=parseInt(e(".marquee").css("margin-left"));-t<e(".marquee p").eq(0).width()?(t--,e(".marquee").css("margin-left",t)):e(".marquee").css("margin-left",0)}window.loadRecords=t}(Zepto)},{}]},{},[2]);
